{% extends 'back/base.html.twig' %}

{% block title %}Transport Index{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h5><a href="#" class="btn btn-outline-secondary">‚Üê Retour</a></h5>
        <a href="{{ path('app_transport_new') }}" class="btn btn-primary">+ Cr√©er un nouveau transport</a>
    </div>

    {# Display flash messages #}
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger">
            {{ message }}
        </div>
    {% endfor %}
    {% for message in app.flashes('success') %}
        <div class="alert alert-success">
            {{ message }}
        </div>
    {% endfor %}

    <div class="row g-4">
        {% for transport in transports %}
            {% set agencyMap = {
                'Elite Logistics Group': 1,
                'Prime Fleet Solutions': 2,
                'Pioneer Transit Services': 3,
                'Velocity Transport Co.': 4,
                'EcoDrive Electric Rentals': 5
            } %}
            {% set agencyId = agencyMap[transport.transportAgence] ?? 0 %}
            {% set agencyFolder = 'agence_' ~ agencyId %}
            {% set transportFolder = transport.transportType|lower %}

            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm border-0 rounded-4 h-100">
                    <div class="card-img-top bg-light d-flex justify-content-center align-items-center" style="height: 250px;">
                        {% if agencyId == 5 %}
                            <img src="{{ asset('assets/images/transport/' ~ agencyFolder ~ '/eco.png') }}" alt="EcoDrive Electric Rentals" class="img-fluid" style="max-height: 240px;">
                        {% else %}
                            <img src="{{ asset('assets/images/transport/' ~ agencyFolder ~ '/' ~ transportFolder ~ '.png') }}" alt="{{ transport.transportType|capitalize }}" class="img-fluid" style="max-height: 240px;">
                        {% endif %}
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="mb-2">
                            <span class="fw-bold text-muted">üöö <span class="fw-bold">Agence :</span></span>
                            <span class="ms-1">{{ transport.transportAgence }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="fw-bold text-muted">üìõ <span class="fw-bold">Nom :</span></span>
                            <span class="ms-1">{{ transport.transportName }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="fw-bold text-muted">üìç <span class="fw-bold">Localisation :</span></span>
                            <span class="ms-1">{{ transport.transportLocation }} ‚Äî {{ transport.transportPays }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="fw-bold text-muted">‚ÑπÔ∏è <span class="fw-bold">Description :</span></span>
                            <span class="ms-1 text-truncate d-block" title="{{ transport.transportDescription }}">{{ transport.transportDescription }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="fw-bold text-muted">üöó <span class="fw-bold">Type :</span></span>
                            <span class="ms-1">{{ transport.transportType|capitalize }}</span>
                        </div>
                        <div class="mb-3">
                            <span class="fw-bold text-muted">üí∞ <span class="fw-bold">Prix :</span></span>
                            <span class="ms-1">${{ transport.transportPrix|number_format(2, '.', ',') }}</span>
                        </div>

                        <div class="mt-auto d-flex gap-2">
                            <a href="{{ path('app_transport_show', {'id': transport.id}) }}" class="btn btn-outline-primary btn-sm w-100">üëÅ Voir</a>
                            <a href="{{ path('app_transport_edit', {'id': transport.id}) }}" class="btn btn-outline-warning btn-sm w-100">‚úè Modifier</a>

                            {% if transport.hasReservations %}
                                <!-- Show the warning modal for cannot delete -->
                                <button class="btn btn-outline-danger btn-sm w-100" data-bs-toggle="modal" data-bs-target="#cannotDeleteModal{{ transport.id }}">üóë Supprimer</button>
                            {% else %}
                                <!-- Show the delete confirmation modal -->
                                <form method="post" action="{{ path('app_transport_delete', {'id': transport.id}) }}" class="d-inline w-100" onsubmit="return confirm('√ätes-vous s√ªr ?');">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ transport.id) }}">
                                    <button class="btn btn-outline-danger btn-sm w-100">üóë Supprimer</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            {# Modal for Cannot Delete (Because of Reservations) #}
            <div class="modal fade" id="cannotDeleteModal{{ transport.id }}" tabindex="-1" aria-labelledby="cannotDeleteModalLabel{{ transport.id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="cannotDeleteModalLabel{{ transport.id }}">Avertissement</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Ce transport ne peut pas √™tre supprim√© car il a des r√©servations.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                        </div>
                    </div>
                </div>
            </div>

            {# Modal for Deletion Confirmation (If No Reservations) #}
            <div class="modal fade" id="deleteWarningModal{{ transport.id }}" tabindex="-1" aria-labelledby="deleteWarningModalLabel{{ transport.id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteWarningModalLabel{{ transport.id }}">Avertissement</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Ce transport est r√©serv√©. Voulez-vous vraiment le supprimer ?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <a href="{{ path('app_transport_delete', {'id': transport.id}) }}" class="btn btn-danger">Supprimer</a>
                        </div>
                    </div>
                </div>
            </div>

        {% else %}
            <div class="col-12 text-center text-muted">Aucun transport trouv√©.</div>
        {% endfor %}
    </div>
</div>
{% endblock %}

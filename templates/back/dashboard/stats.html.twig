{% extends 'back/base.html.twig' %}

{% block title %}Tableau de bord - TripEase{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-100">
    <header class="bg-white shadow w-full">
        <div class="flex items-center justify-between px-6 py-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center w-full">Tableau de bord</h1>
        </div>
    </header>

    <main class="p-6 w-full">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Carte des utilisateurs totaux -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Utilisateurs Totaux</h2>
                <p class="text-4xl font-bold text-blue-600">{{ stats.total }}</p>
            </div>

            <!-- Carte des utilisateurs actifs -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Utilisateurs Actifs</h2>
                <p class="text-4xl font-bold text-green-600">{{ stats.active }}</p>
            </div>

            <!-- Carte des managers -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Managers</h2>
                <p class="text-4xl font-bold text-purple-600">{{ stats.managers }}</p>
            </div>

            <!-- Carte des clients -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Clients</h2>
                <p class="text-4xl font-bold text-orange-600">{{ stats.clients }}</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <!-- Graphique des utilisateurs par rôle -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Utilisateurs par Rôle</h2>
                <canvas id="roleChart"></canvas>
            </div>

            <!-- Graphique des utilisateurs par statut -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Utilisateurs par Statut</h2>
                <canvas id="statusChart"></canvas>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Graphique des utilisateurs par rôle
            const roleCtx = document.getElementById('roleChart').getContext('2d');
            new Chart(roleCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys({{ stats.by_role|json_encode|raw }}),
                    datasets: [{
                        data: Object.values({{ stats.by_role|json_encode|raw }}),
                        backgroundColor: [
                            '#3B82F6',
                            '#10B981',
                            '#F59E0B'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Graphique des utilisateurs par statut
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys({{ stats.by_status|json_encode|raw }}),
                    datasets: [{
                        data: Object.values({{ stats.by_status|json_encode|raw }}),
                        backgroundColor: [
                            '#10B981',
                            '#EF4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
    </script>
{% endblock %} 